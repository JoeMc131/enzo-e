# Problem: Axis aligned Shock Tube test problem for VLCT
# Author: Matthew Abruzzo (matthewabruzzo@gmail.com)

# Sod Shock Tube Test Problem along x-axis
# tests the dual energy formalism by using a background velocity-x component
# with a Mach number of ~10 in the hot region.
#
# Determining the velocity:
# In the normal case, we use a domain with stretching from 0 to 1 with 256
# cells; this gives a dx = 1. / 256 . We also know that the interval of time
# that we allow the cloud to evolve over is dt = 0.25 . Additionally, we can
# compute the sound speed in the hottest gas of the initial conditions using
# cs = sqrt (gamma * p / rho); canonically, gamma=1.4, p = 1, and rho = 1.
#
# If we are targetting some Mhat then we can determine the closest velocity
# that leads to a translation over an integral number of cells over dt. The
# number of cells is given by:
#    Ncells = floor(cs * Mhat / (dx / dt) + 0.5)
# Once we know Ncells, we can easily compute the additional velocity component
#    velocity = Ncells * dx / dt
#
# For Mhat=10: Ncells = 757 and velocity = 11.8281 (should be 11.828125). The
# actual Mach number is 9.997
# We set the number of cells to be 256 + 757 + 1 = 1014 (the extra value of 1
# was added so that the mesh could be evenly split over 2 blocks)
# We set the upper limit of the domain equal to 1014*dx
#
# The result in the domain [2.95703125, 3.95703125] should be compared to the
# expected result (it's surprisingly not as smeared out as one might expect)

   include "input/vlct/vlct_de.incl"
   include "input/vlct/dual_energy_shock_tube/initial_sod_shock_tube.incl"

   Domain {
      lower = [0.0, 0.0, 0.0];
      upper = [3.9609375, 0.03125, 0.03125];
   }

   Mesh {
      root_rank = 3; # 3D
      root_blocks = [2,2,2];
      root_size = [1014,8,8]; # number of cells per axis
   }

   Initial{
      shock_tube{
	 axis_velocity = 11.8281;
      };
   }

   Output {
      data {
	 dir = ["method_vlct-1-sod_shock_tube_aligned_M10_de%.2f","time"];
      };
   }